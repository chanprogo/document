

假设我们有张表，结构如下：   
```
create table user(
  id int(11) not null,
  age int(11) not null,
  primary key(id),
  key(age)
);

```




## 聚簇 和 非聚簇 索引

索引 按照 数据结构 来说 主要包含 B+ 树 和 Hash 索引。  


B+ 树是 左小右大 的 顺序 存储结构，
节点只包含 id 索引列，
而 叶子节点 包含 索引列和数据，
这种 数据和索引 在一起存储的 索引方式 叫做聚簇索引，  

一张表 只能有 一个 聚簇索引。假设没有定义主键，InnoDB 会选择 一个唯一的 非空索引代替，如果没有的话 则会隐式定义 一个主键 作为 聚簇索引。  


非聚簇索引(二级索引) 保存的是 主键 id 值，这一点和 myisam 保存的是 数据地址 是不同的。  



## 什么是覆盖索引和回表

覆盖索引 指的是 在一次查询中，如果一个索引  包含或者说覆盖  所有 需要查询的字段 的值，我们就称之为 覆盖索引，而不再需要回表查询。

而要确定一个查询  是否是  覆盖索引，我们只需要 explain sql 语句看 Extra 的结果是否是 “Using index” 即可。

以上面的 user 表来举例，我们再增加一个 name 字段，然后做一些查询试试。
`explain select * from user where age=1;` // 查询的 name 无法从索引数据获取 
`explain select id,age from user where age=1;` // 可以直接从索引获取
  




## 为搜索字段建索引  

索引 并不一定就是 给 主键 或是 唯一的字段。如果在你的表中，有某个字段 你会经常 用来做搜索，那么可以为其建立索引。

什么样的搜索 是不能 使用 正常的索引的。
例如，当你需要在一篇大的文章中 搜索一个词时，如 `WHERE post_content LIKE ‘%apple%'` 索引可能是没有意义的。
你可能需要使用 MySQL 全文索引 或是自己做一个索引，比如说 搜索关键词 或是 Tag 什么的  






## MySQL 的索引是不是越多越好

从存储结构来说，索引多了后 占磁盘的存储量 也会大，存在维护 以及 成本开销  

从一些 crud 来说，索引多了后，进行删除，新增 以及 修改时 会涉及 多个索引树 的变更，导致 SQL 执行速度变慢  

从锁来说，在 RR 的 事务隔离级别下，由于 next-key lock 的作用  避免了 幻读，但是 有可能 导致 对多个事务分别同时 对多个数据 进行变更时 导致死锁  